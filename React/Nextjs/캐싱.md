- [Next.js 가 데이터를 캐시하는 방법](#nextjs-가-데이터를-캐시하는-방법)
  - [서버 측 캐시](#서버-측-캐시)
    - [요청 메모이제이션](#요청-메모이제이션)
    - [데이터 캐시](#데이터-캐시)
    - [전체 라우트 캐시](#전체-라우트-캐시)
  - [클라이언트 측 캐시](#클라이언트-측-캐시)
    - [라우터 캐시](#라우터-캐시)

# Next.js 가 데이터를 캐시하는 방법

<!-- ?? -->

Nextjs 앱 라우터에서 캐싱은 기본적으로 실행된다.

Nextjs의 캐싱 메커니즘은 4가지가 있으며 프로덕션 상태일 때 일어난다(개발 모드에선 no).

## 서버 측 캐시

### 요청 메모이제이션

- 동일한 `fetch` GET 요청을 캐시(동일 URL, 옵션).
- 여러 컴포넌트에서 동일한 요청 시 캐시되어 한번만 요청함.
- 상위 컴포넌트에서 요청하여 `prop`으로 내려줄 필요 없이 각 컴포넌트에서 동일한 요청을 하면됨.
- 캐시 재검증할 수 없으며 요청은 `AbortController`로 취소할 수 있다.

### 데이터 캐시

- 단일 페치 요청에서 페치된 모든 데이터를 캐싱.
- 캐시를 업데이트 하지 않는 이상 영구적으로 저장됨. 즉, 앱이 재배포 되어도 캐시된 데이터는 남아있다.
<!-- ? -->
- 정적인 페이지를 위한 데이터, 데이터 재검증 시 ISR?(빌드 후 정적 페이지 업데이트/?)
- `fetch`시 `next.revalidate` 옵션을 설정하여 일정 시간이 지나면 다시 특정 데이터를 `fetch` 하도록 만들 수 있다(시간 기반 재검증).
- 이벤트(ex) 폼 제출)에 따라 데이터 재검증(주문형 재검증). 태그, 경로 기반 재검증 가능
- 매번 새롭게 페치하려면 `page.js`에서 `export const revalidate = 0` 설정해주면 된다.

### 전체 라우트 캐시

- 정적 페이지 전체(HTML, RSC payload) 캐시. 데이터 캐시가 유효하지 않게 될 때 까지(데이터 캐시가 재검증 될 때까지 혹은 앱이 재배포되기 전까지) 지속됨
- 정적 페이지에서 가능.
- 데이터 캐시가 재검증 되는 경우에 재검증 일어남.
- 정적 사이트에서 유용(블로그 등)

## 클라이언트 측 캐시

### 라우터 캐시

- 사전 페치됐거나 사용자가 방문했던 정적, 동적 페이지 캐시.
- 싱글 페이지 애플리케이션같은 페이지 전환 가능.
- 동적 페이지라면 30초, 정적 페이지라면 5분 지속됨.

**[Caching in Next.js]**

https://nextjs.org/docs/app/building-your-application/caching
