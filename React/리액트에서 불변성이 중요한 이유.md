# 불변성(Immutablity)이란?

불변성이란 메모리에 저장된 값을 변경할 수 없는 것을 말한다. 자바스크립트에서 불변성을 갖는 값들은 `Number`, `String` 과 같은 원시 값들이다.

불변 값이 저장된 변수는 값 자체를 변경할 수는 없고, 재할당으로만 값을 변경(교체) 할 수 있다. 만약 재할당이 불가능한 `const` 변수에 원시 값(불변 값)를 저장하면, 변수의 값을 아예 변경할 수 없다.

## 불변성(Immutablity)의 이점

우선 자바스크립트에서 불변성의 이점을 알아본다.

불변성을 갖는 원시 값의 경우 메모리에 저장된 값을 변경할 수 없다. 따라서 변수에 원시 값이 저장된 경우 재할당을 통해서만 변경할 수 있는데(엄밀히는 교체하는 것) 이러한 특징은 다음과 같은 장점이 있다.

1. 예기치 못한 변경으로 인한(부수효과로 인한) 잠재적인 버그를 방지한다.
2. 데이터 신뢰성을 보장한다. -> 데이터를 예측하기 쉽고 그에 따라 테스트하기도 쉽다.

## 리액트에서 불변성이 중요한 이유?

React 공식 문서에는 배열이나 객체와 같은 참조를 통해 접근하는 변경 가능(mutable) 데이터들도 원시 값처럼 읽기 전용으로 즉, 불변 값(immutable value)으로 취급하라고 되어있다.

배열 상태 변수로 예를 들면 `arr[0] = 'bird'`, `push()`, `pop()` 같이 직접 변경하거나 요소를 추가, 삭제하는게 아닌 새로운 배열로 재할당해야 한다는 것이다(물론 `push()` 메서드와 같은 방법으로 직접 변경이 동작하지 않는 것은 아니다).

리액트 공식 문서에서 말하는 불변성의 장점은 다음과 같다.

1. 직접적인 데이터 변형을 피하면 이전 버전의 데이터를 그대로 유지하고 나중에 재사용할 수 있습니다. -> 리액트의 새 기능들은 스냅샷처럼 취급되는 이전 상태에 의존한다. 따라서 이전 상태를 직접 변경하게 되면 새 기능을 사용하지 못할 수도 있다고 한다.   
   
2. 불변성은 컴포넌트의 데이터가 변경되었는지 여부를 비교하는 데 매우 저렴합니다. -> 주소 값 변경 여부만으로 쉽게 변경을 감지할 수 있기 때문.
  
또한 리액트는 상태 변경을 얕은 비교를 통해 감지한다. 즉, 참조를 저장하는 객체, 배열과 같은 데이터의 경우 참조가 변경되었을 때 변경으로 감지하고, 렌더링을 트리거한다. 

만약 값을 직접 변경하면 변경을 감지하지 못해 컴포넌트 렌더링이 발생하지 않는다. 또한  `React.memo`를 사용한 하위 컴포넌트에서도 `props`의 변경을 제대로 감지하지 못하게 된다.

<!-- immer 사용법?-->

## Reference

**[React docs 불변성을 권장하는 이유]**

https://react.dev/learn/updating-objects-in-state#why-is-mutating-state-not-recommended-in-react

**[React docs 불변성이 중요한 이유]**

https://stackoverflow.com/questions/34385243/why-is-immutability-so-important-or-needed-in-javascript

https://beta.reactjs.org/learn/tutorial-tic-tac-toe#why-immutability-is-important

https://velopert.com/3486
