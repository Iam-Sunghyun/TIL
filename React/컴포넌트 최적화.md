<h2>목차</h2>

- [`React.memo`로 컴포넌트 최적화하기](#reactmemo로-컴포넌트-최적화하기)
- [`useCallback`](#usecallback)
- [`useMemo`로 메모이제이션하기](#usememo로-메모이제이션하기)

# `React.memo`로 컴포넌트 최적화하기

**[React 성능 최적화 - React가 UI를 업데이트하는 방법 이해]**

https://blog.logrocket.com/optimizing-performance-react-app/#react-update-ui

# `useCallback`

# `useMemo`로 메모이제이션하기

`useMemo`의 `memo`는 메모이제이션(memoization)을 의미한다. 입력이 동일한 경우 중복된 연산을 건너뛰고 메모리에 캐시 된 데이터를 사용하여 불필요한 중복 연산을 건너뛰는 것.

사용 형식은 다음과 같다.

```
const value = useMemo(() => {
  return calculate();
}, [item]);
```

첫 번째로 콜백 함수를 전달하는데 이 함수는 메모이제이션 할 값을 반환하는 함수이다. 이 콜백이 반환하는 값이 곧 `useMemo()`가 반환하는 값이 되며 메모이제이션 되는 값이다(위 `value`에 할당).

두 번째로 의존성 배열을 전달한다. 이 의존성이 변경되었을 때만 첫 번째로 전달한 콜백을 호출하고 콜백이 반환한 새 값을 또 다시 새롭게 메모이제이션한다.

만약 의존성에 빈 배열을 전달했을 경우, 컴포넌트가 처음 마운트 됐을 때만 콜백을 호출하여 메모이제이션한다.

다음은 `useMemo`를 사용한 예시이다.

```
function App() {
  const [number, setNumber] = useState(0);
  const [isKorea, setIsKorea] = useState(true);

  const location = {
    country: isKorea ? '한국' : '외국'
  };

  useEffect(() => {
    console.log('useEffect 테스트');
  }, [location]);

  return (
    <div>
      <h2>하루에 몇끼 먹어요?</h2>
      <input
        type='number'
        value={number}
        onChange={(e) => setNumber(e.target.value)}
      />
      <hr />
      <h2>어느 나라에 있어요?</h2>
      <p>{location.country}</p>
      <button onClick={() => setIsKorea(!isKorea)}>비행기 탑승</button>
    </div>
  )
}

export default App;
```

위 코드에서 `useEffect`는 렌더링마다 새롭게 초기화되는 `location` 객체로 인해 `location`의 프로퍼티 값이 변경 된 경우가 아니어도 매번 실행된다(참조가 새롭게 할당되므로).

이런 경우 아래와 같이 `useMemo`를 사용하여 객체를 메모이제이션 해주고, 객체의 프로퍼티를 변경시키는 `isKorea` 상태 변수를 의존성으로 설정하여 `isKorea`가 변경된 경우에만 객체를 새로 초기화 하도록 만들어준다.

```
function App() {
  const [number, setNumber] = useState(0);
  const [isKorea, setIsKorea] = useState(true);

  const location = useMemo(() => {
    return {
      country: isKorea ? '한국' : '외국'
    }
  }, [isKorea]);

  useEffect(() => {
    console.log('useEffect 테스트');
  }, [location]);

  return (
    <div>
      <h2>하루에 몇끼 먹어요?</h2>
      <input
        type='number'
        value={number}
        onChange={(e) => setNumber(e.target.value)}
      />
      <hr />
      <h2>어느 나라에 있어요?</h2>
      <p>{location.country}</p>
      <button onClick={() => setIsKorea(!isKorea)}>비행기 탑승</button>
    </div>
  )
}

export default App;
```

참고로 `useMemo()`는 메모리에 결과를 저장해놓고 재사용하는 것이므로 무분별하게 사용할 경우 메모리 낭비가 커질 수 있다.
